%%{init: {'theme':'base', 'themeVariables': {'primaryColor':'#e3f2fd','primaryTextColor':'#01579b','primaryBorderColor':'#01579b','lineColor':'#0277bd','secondaryColor':'#fff3e0','tertiaryColor':'#f3e5f5'}}}%%
flowchart TD
    %% Style definitions
    classDef moduleOperationnel fill:#c8e6c9,stroke:#2e7d32,stroke-width:3px,color:#1b5e20
    classDef moduleDev fill:#fff9c4,stroke:#f57f17,stroke-width:3px,color:#f57f17
    classDef moduleTransversal fill:#e1bee7,stroke:#6a1b9a,stroke-width:2px,color:#4a148c
    classDef pipelineParallele fill:#ffccbc,stroke:#d84315,stroke-width:2px,color:#bf360c
    classDef decision fill:#b3e5fc,stroke:#0277bd,stroke-width:2px,color:#01579b
    classDef output fill:#c5e1a5,stroke:#558b2f,stroke-width:2px,color:#33691e
    classDef storage fill:#d1c4e9,stroke:#512da8,stroke-width:2px,color:#311b92

    %% === PIPELINE PRINCIPAL (MODULES 1-8) ===

    %% Module 1
    START([ğŸ“š 317 Manuscrits juridiques mÃ©diÃ©vaux<br/>et environ 150 Ã‰ditions de manuscrits]):::output
    START --> M1

    M1[MODULE 1<br/>ğŸ–¼ï¸ TÃ©lÃ©chargement Images<br/>â”€â”€â”€<br/>Sources : IIIF, PDF, Hexa, Tuiles<br/>Script : download_images.py<br/>Sortie : Images JPG/PNG]:::moduleOperationnel

    M1 --> M2

    %% Module 2
    M2[MODULE 2<br/>ğŸ“ OCR & Reconnaissance<br/>â”€â”€â”€<br/>Outils : Tesseract, Kraken<br/>EntrÃ©e : Images manuscrits<br/>Sortie : Texte brut]:::moduleOperationnel

    M2 --> M3

    %% Module 3
    M3[MODULE 3<br/>âœ‚ï¸ Segmentation & Structuration<br/>â”€â”€â”€<br/>Processus : DÃ©coupage sÃ©mantique<br/>EntrÃ©e : Texte brut<br/>Sortie : Texte structurÃ©]:::moduleOperationnel

    M3 --> M4

    %% Module 4
    M4[MODULE 4<br/>âœ… Corrections & Validation<br/>â”€â”€â”€<br/>Processus : Validation manuelle/semi-auto<br/>EntrÃ©e : Texte structurÃ©<br/>Sortie : Texte validÃ©]:::moduleOperationnel

    M4 --> M5

    %% Module 5
    M5[MODULE 5<br/>ğŸ’¾ Export & PrÃ©paration<br/>â”€â”€â”€<br/>Processus : PrÃ©paration archivage<br/>EntrÃ©e : Texte validÃ©<br/>Sortie : DonnÃ©es prÃªtes]:::moduleOperationnel

    M5 --> VALIDATION_DECISION

    %% Latin Analyzer (validation optionnelle)
    VALIDATION_DECISION{Validation<br/>qualitÃ© latine ?}:::decision
    VALIDATION_DECISION -->|Non| M6
    VALIDATION_DECISION -->|Oui| LATIN_ANALYZER

    LATIN_ANALYZER[LATIN ANALYZER<br/>ğŸ” Validation Textes Latins<br/>â”€â”€â”€<br/>Optionnel - ContrÃ´le QualitÃ©<br/>â”€â”€â”€<br/>Sources :<br/>â€¢ PyCollatinus classique 500k formes<br/>â€¢ Du Cange mÃ©diÃ©val 99k mots<br/>â”€â”€â”€<br/>Scoring 0-100 multi-critÃ¨res<br/>Colorisation 3 niveaux<br/>â”€â”€â”€<br/>Sortie : DOCX + Rapport]:::moduleTransversal

    LATIN_ANALYZER --> M6

    %% Module MÃ©tadonnÃ©es (transversal)
    META_START([ğŸ“‹ Fiches Manuscrits]):::output
    META_START --> META

    META[MODULE MÃ‰TADONNÃ‰ES<br/>ğŸ—„ï¸ Base Heurist<br/>â”€â”€â”€<br/>Transversal<br/>â”€â”€â”€<br/>3 Tables :<br/>â€¢ Auteurs Type 10<br/>â€¢ Oeuvres Type 107<br/>â€¢ Ã‰ditions Type 105<br/>â”€â”€â”€<br/>5,768 records<br/>~150 Ã©ditions]:::moduleTransversal

    META -->|Consultation manuelle<br/>Copie mÃ©tadonnÃ©es| CONFIG
    CONFIG[config.yaml<br/>â”€â”€â”€<br/>edition_id, title,<br/>author, language,<br/>date, lieu...]:::storage
    CONFIG -->|MÃ©tadonnÃ©es<br/>bibliographiques| M6

    %% Module 6
    M6[MODULE 6<br/>ğŸ”¬ PAGEtopage<br/>Enrichissement Linguistique<br/>â”€â”€â”€<br/>ğŸš§ En dÃ©veloppement<br/>â”€â”€â”€<br/>STEP 1 : Extract XML â†’ JSON<br/>STEP 2 : Enrich TreeTagger<br/>â€¢ DÃ©coupage phrases<br/>â€¢ Tokenisation<br/>â€¢ Lemmatisation<br/>â€¢ POS-tagging<br/>STEP 3 : Export 4 formats<br/>STEP 4 : Re-enrich optionnel<br/>â€¢ Correction manuelle<br/>â€¢ RÃ©gÃ©nÃ©ration vertical<br/>â”€â”€â”€<br/>Python 3.10+, TreeTagger auto-installÃ©]:::moduleDev

    M6 --> FORMATS

    FORMATS[4 FORMATS PRODUITS<br/>â”€â”€â”€<br/>1ï¸âƒ£ scholarly recommandÃ©<br/>en-tÃªte + mÃ©tadonnÃ©es<br/>â”€â”€â”€<br/>2ï¸âƒ£ clean texte brut<br/>â”€â”€â”€<br/>3ï¸âƒ£ diplomatic annotÃ©<br/>â”€â”€â”€<br/>4ï¸âƒ£ annotated tabulaire<br/>â”€â”€â”€<br/>+ corpus_vertical.txt<br/>forme / POS / lemme]:::output

    FORMATS -->|corpus_vertical.txt| M7
    FORMATS -->|Tous formats<br/>+ mÃ©tadonnÃ©es| M8

    %% Module 7
    M7[MODULE 7<br/>ğŸ” NoSketch-Engine<br/>Corpus Interrogeable<br/>â”€â”€â”€<br/>Workflow :<br/>1. Fusion Fusion_txt_NoSketch.py<br/>2. Copie locale<br/>3. Test instance locale<br/>4. Export SCP serveur<br/>5. Compilation corpus<br/>6. Mise en service<br/>â”€â”€â”€<br/>FonctionnalitÃ©s :<br/>â€¢ Concordances KWIC<br/>â€¢ Collocations<br/>â€¢ Recherche lemme/forme/POS<br/>â€¢ Statistiques frÃ©quences]:::moduleOperationnel

    M7 --> OUT_NOSKETCH
    OUT_NOSKETCH([ğŸŒ Corpus CiSaMe<br/>sur NoSketch-Engine<br/>Analyse linguistique interactive]):::output

    %% Module 8
    M8[MODULE 8<br/>ğŸ“¤ Diffusion DonnÃ©es Textuelles<br/>â”€â”€â”€<br/>DÃ©cision : Avec/Sans images<br/>Ã— Libre/Restreint<br/>â”€â”€â”€<br/>Outils :<br/>â€¢ Connecteur Nakala<br/>â€¢ Cloud Seafile]:::moduleOperationnel

    M8 --> DEC_IMAGES
    DEC_IMAGES{Avec images ?}:::decision

    %% Branche AVEC images
    DEC_IMAGES -->|Oui| DEC_LIBRE1
    DEC_LIBRE1{Licence libre ?}:::decision
    DEC_LIBRE1 -->|Oui| NAKALA_IMG_LIBRE
    DEC_LIBRE1 -->|Non| SEAFILE_IMG

    NAKALA_IMG_LIBRE[Export Nakala<br/>via Connecteur Nakala<br/>â”€â”€â”€<br/>Contenu :<br/>â€¢ Images manuscrits<br/>â€¢ Textes enrichis<br/>â€¢ MÃ©tadonnÃ©es<br/>â€¢ pages_index.json]:::storage

    SEAFILE_IMG[Export Seafile<br/>Cloud universitaire<br/>â”€â”€â”€<br/>AccÃ¨s restreint<br/>DonnÃ©es privÃ©es]:::storage

    %% Branche SANS images
    DEC_IMAGES -->|Non| DEC_LIBRE2
    DEC_LIBRE2{Licence libre ?}:::decision
    DEC_LIBRE2 -->|Oui| NAKALA_TEXTE
    DEC_LIBRE2 -->|Non| SEAFILE_TEXTE

    NAKALA_TEXTE[Export Nakala<br/>via Connecteur Nakala<br/>â”€â”€â”€<br/>Contenu :<br/>â€¢ Textes seulement<br/>â€¢ MÃ©tadonnÃ©es<br/>â€¢ Documentation]:::storage

    SEAFILE_TEXTE[Export Seafile<br/>Cloud universitaire<br/>â”€â”€â”€<br/>AccÃ¨s restreint<br/>Textes uniquement]:::storage

    NAKALA_IMG_LIBRE --> FINAL
    NAKALA_TEXTE --> FINAL
    SEAFILE_IMG --> FINAL
    SEAFILE_TEXTE --> FINAL

    FINAL([âœ… DonnÃ©es CiSaMe diffusÃ©es<br/>Archives scientifiques<br/>publiques et privÃ©es]):::output

    %% === PIPELINE PARALLÃˆLE : DÃ‰CRET DE GRATIEN ===

    DECRET_START([ğŸ“œ DÃ©cret de Gratien]):::output
    DECRET_START --> DECRET

    DECRET[PIPELINE PARALLÃˆLE<br/>ğŸ”´ DÃ©cret de Gratien<br/>â”€â”€â”€<br/>âš ï¸ NE PASSE PAS par MODULE 6<br/>â”€â”€â”€<br/>Workflow spÃ©cifique :<br/>â€¢ Format .txt adaptÃ©<br/>â€¢ Script personnalisÃ©<br/>â€¢ DÃ©jÃ  traitÃ©<br/>â”€â”€â”€<br/>âœ… DÃ©jÃ  sur NoSketch-Engine<br/>Corpus opÃ©rationnel]:::pipelineParallele

    DECRET --> DECRET_OUT
    DECRET_OUT([ğŸŒ DÃ©cret de Gratien<br/>sur NoSketch-Engine]):::output

    %% === NOTES ET LÃ‰GENDES ===

    NOTE1[â„¹ï¸ NOTES IMPORTANTES<br/>â”€â”€â”€<br/>1. MODULE 6 en dÃ©veloppement<br/>2. MÃ©tadonnÃ©es : processus manuel<br/>Heurist â†’ config.yaml<br/>3. Latin Analyzer : validation<br/>qualitÃ© optionnelle aprÃ¨s M4/M5<br/>4. DÃ©cret de Gratien :<br/>pipeline sÃ©parÃ©, dÃ©jÃ  opÃ©rationnel<br/>5. Module 7 utilise uniquement<br/>fichiers .vertical.txt<br/>6. Module 8 : diffusion finale<br/>tous formats selon licence]:::moduleTransversal

    %% === LÃ‰GENDE ===

    LEGEND[ğŸ“Š LÃ‰GENDE<br/>â”€â”€â”€<br/>ğŸŸ¢ Module opÃ©rationnel<br/>ğŸŸ¡ Module en dÃ©veloppement<br/>ğŸŸ£ Module transversal<br/>ğŸ”´ Pipeline parallÃ¨le<br/>ğŸ”µ DÃ©cision<br/>ğŸ“¦ Stockage/Archive]:::moduleTransversal
