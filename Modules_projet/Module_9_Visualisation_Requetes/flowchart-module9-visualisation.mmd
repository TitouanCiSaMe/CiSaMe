flowchart TD
    %% ========================================
    %% MODULE 9 - VISUALISATION ET G√âN√âRATEUR DE REQU√äTES
    %% ========================================

    START([üìä MODULE 9<br/>Canon-Law-Toolkit<br/>Analyse du Corpus NoSketch-Engine])

    %% ========================================
    %% D√âCISION PRINCIPALE
    %% ========================================
    DECISION{Quel<br/>module ?}

    START --> DECISION

    %% ========================================
    %% BRANCHE 1 : QUERY GENERATOR
    %% ========================================
    subgraph QUERY_GEN [üîç Query Generator - G√©n√©rateur de Requ√™tes CQL]
        QG_START[G√©n√©rateur de<br/>requ√™tes CQL]

        subgraph QG_TYPES [Types de Recherche]
            QG_PROXIMITY[üìç Proximit√©<br/>Recherche mots √† distance<br/>configurable 1-20 tokens]
            QG_VARIATIONS["üîÑ Variations<br/>Orthographe m√©di√©vale:<br/>‚Ä¢ ae/e (caelum ‚Üí celum)<br/>‚Ä¢ v/u (servus ‚Üí seruus)<br/>‚Ä¢ j/i (justitia ‚Üí iustitia)<br/>‚Ä¢ ti/ci (gratia ‚Üí gracia)<br/>96 variantes possibles"]
            QG_SEMANTIC[üß† S√©mantique<br/>Recherche conceptuelle<br/>avanc√©e]
            QG_COMBINED["üìçüîÑ Proximit√© + Variations<br/>Combinaison des deux approches"]
        end

        QG_CONFIG["‚öôÔ∏è Configuration:<br/>‚Ä¢ Distance entre mots<br/>‚Ä¢ Types de variations<br/>‚Ä¢ Options lemmatisation"]

        QG_GENERATE[‚ö° G√©n√©ration requ√™te CQL<br/>Pr√©visualisation en temps r√©el]

        subgraph QG_EXPORT [Export]
            QG_COPY[üìã Copier requ√™te<br/>Coller dans NoSketch]
            QG_DIRECT[üöÄ Lancer directement<br/>sur NoSketch Engine]
        end

        QG_START --> QG_PROXIMITY
        QG_START --> QG_VARIATIONS
        QG_START --> QG_SEMANTIC
        QG_START --> QG_COMBINED

        QG_PROXIMITY --> QG_CONFIG
        QG_VARIATIONS --> QG_CONFIG
        QG_SEMANTIC --> QG_CONFIG
        QG_COMBINED --> QG_CONFIG

        QG_CONFIG --> QG_GENERATE
        QG_GENERATE --> QG_COPY
        QG_GENERATE --> QG_DIRECT
    end

    DECISION -->|Query Generator| QG_START

    %% ========================================
    %% BRANCHE 2 : CONCORDANCE ANALYZER - 1 CORPUS
    %% ========================================
    subgraph CONCORD_SINGLE [üìä Concordance Analyzer - Analyse Simple]
        CS_UPLOAD["üì• Upload fichiers:<br/>‚Ä¢ M√©tadonn√©es CSV (Edi-XX)<br/>‚Ä¢ Export NoSketch Engine<br/>‚ö†Ô∏è Cocher: ID √©dition + n¬∞ pages"]

        CS_PERSIST["üíæ Persistance automatique:<br/>Donn√©es sauvegard√©es<br/>Restauration au rechargement"]

        CS_ENRICH["üîó Enrichissement automatique:<br/>‚Ä¢ Matching r√©f√©rences Edi-XX<br/>‚Ä¢ Parsing structure complexe<br/>‚Ä¢ Fallback robuste<br/>‚Ä¢ Taux de correspondance"]

        CS_ANALYZE["üìà 9 Vues d'analyse sp√©cialis√©es:<br/>‚Ä¢ Vue d'ensemble + stats globales<br/>‚Ä¢ Domaines juridiques<br/>‚Ä¢ Auteurs<br/>‚Ä¢ P√©riodes<br/>‚Ä¢ Lieux<br/>‚Ä¢ Timeline interactive<br/>‚Ä¢ Analyse terminologique<br/>‚Ä¢ Nuage de mots KWIC<br/>‚Ä¢ Graphiques (Bar, Temporal, Gantt)"]

        CS_FILTERS["üéöÔ∏è Filtres avanc√©s:<br/>‚Ä¢ Recherche textuelle<br/>‚Ä¢ Auteur<br/>‚Ä¢ Domaine juridique<br/>‚Ä¢ P√©riode<br/>‚Ä¢ Lieu<br/>‚Ä¢ Combinaisons multiples"]

        CS_EXPORT["üíæ Export multi-formats:<br/>‚Ä¢ CSV (concordances filtr√©es)<br/>‚Ä¢ JSON (analytics compl√®tes)<br/>‚Ä¢ PNG (graphiques)"]

        CS_UPLOAD --> CS_PERSIST
        CS_PERSIST --> CS_ENRICH
        CS_ENRICH --> CS_ANALYZE
        CS_ANALYZE --> CS_FILTERS
        CS_FILTERS --> CS_EXPORT
    end

    DECISION -->|Concordance Analyzer<br/>1 corpus| CS_UPLOAD

    %% ========================================
    %% BRANCHE 3 : CONCORDANCE ANALYZER - COMPARAISON 2 CORPUS
    %% ========================================
    subgraph CONCORD_COMPARE [üîÄ Concordance Analyzer - Comparaison]
        CC_UPLOAD["üì•üì• Upload 2 fichiers:<br/>‚Ä¢ Corpus A (r√©f√©rence)<br/>‚Ä¢ Corpus B (comparaison)<br/>+ M√©tadonn√©es CSV"]

        CC_ENRICH["üîó Enrichissement des 2 corpus<br/>Matching automatique Edi-XX"]

        CC_COMPARE["‚öñÔ∏è Analyse comparative:<br/>‚Ä¢ Volumes (tailles corpus)<br/>‚Ä¢ Auteurs (r√©partitions)<br/>‚Ä¢ Domaines juridiques<br/>‚Ä¢ Temporalit√© (√©volutions)<br/>‚Ä¢ Terminologie (KWIC)<br/>‚Ä¢ Charts comparatifs parall√®les"]

        CC_FILTERS["üéöÔ∏è Filtres ind√©pendants<br/>pour chaque corpus"]

        CC_EXPORT["üíæ Export analyses comparatives:<br/>‚Ä¢ CSV (donn√©es compar√©es)<br/>‚Ä¢ JSON (analytics compl√®tes)<br/>‚Ä¢ PNG (graphiques parall√®les)"]

        CC_UPLOAD --> CC_ENRICH
        CC_ENRICH --> CC_COMPARE
        CC_COMPARE --> CC_FILTERS
        CC_FILTERS --> CC_EXPORT
    end

    DECISION -->|Concordance Analyzer<br/>Comparaison 2 corpus| CC_UPLOAD

    %% ========================================
    %% SORTIE
    %% ========================================
    OUTPUT([üì§ SORTIE MODULE 9<br/>Requ√™tes CQL + Analyses<br/>Visualisations export√©es])

    QG_COPY --> OUTPUT
    QG_DIRECT --> OUTPUT
    CS_EXPORT --> OUTPUT
    CC_EXPORT --> OUTPUT

    %% ========================================
    %% ANNOTATIONS
    %% ========================================
    note1["üí° CQL:<br/>Corpus Query Language<br/>Langage standard NoSketch<br/>Validation temps r√©el"]
    note2["üí° M√©tadonn√©es Edi-XX:<br/>Identifiants collections<br/>canoniques m√©di√©vales<br/>Pr√©-chargement automatique"]
    note3["üí° Interface multilingue:<br/>Fran√ßais / Anglais<br/>react-i18next<br/>Traductions compl√®tes"]
    note4["üí° Visualisations:<br/>Recharts + D3.js<br/>Interactives et exportables<br/>Timeline Gantt"]
    note5["üí° Technologies:<br/>React 18.2, Vite 5.0<br/>CSS Modules<br/>Vitest + React Testing Library"]

    QG_GENERATE -.-> note1
    CS_ENRICH -.-> note2
    CS_ANALYZE -.-> note3
    CS_EXPORT -.-> note4
    START -.-> note5

    %% ========================================
    %% STATISTIQUES
    %% ========================================
    subgraph STATS [üìä Caract√©ristiques]
        S1[4 types de requ√™tes CQL]
        S2[9 vues d'analyse sp√©cialis√©es]
        S3[Comparaison de 2 corpus]
        S4[3 formats export: CSV, JSON, PNG]
        S5[Persistance automatique donn√©es]
        S6[Interface FR/EN]
    end

    %% ========================================
    %% OUTILS
    %% ========================================
    subgraph TOOLS [üõ†Ô∏è Stack Technique]
        T1[React 18.2 + Vite 5.0]
        T2[Recharts + D3.js]
        T3[react-i18next]
        T4[CSS Modules]
        T5[Vitest + RTL]
        T6[NoSketch Engine API]
    end

    %% ========================================
    %% STYLES
    %% ========================================
    classDef startEnd fill:#4caf50,stroke:#2e7d32,stroke-width:3px,color:#fff
    classDef decision fill:#ffeb3b,stroke:#f57f17,stroke-width:3px
    classDef queryGen fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef queryType fill:#bbdefb,stroke:#1976d2,stroke-width:2px
    classDef config fill:#b2dfdb,stroke:#00796b,stroke-width:2px
    classDef concordSingle fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef concordCompare fill:#ffecb3,stroke:#ff6f00,stroke-width:2px
    classDef process fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    classDef export fill:#a5d6a7,stroke:#2e7d32,stroke-width:2px
    classDef note fill:#fff9c4,stroke:#f57f17,stroke-width:1px,stroke-dasharray: 5 5

    class START,OUTPUT startEnd
    class DECISION decision
    class QG_START,QG_GENERATE queryGen
    class QG_PROXIMITY,QG_VARIATIONS,QG_SEMANTIC,QG_COMBINED queryType
    class QG_CONFIG,CS_FILTERS,CC_FILTERS config
    class CS_UPLOAD,CS_PERSIST,CS_ENRICH,CS_ANALYZE concordSingle
    class CC_UPLOAD,CC_ENRICH,CC_COMPARE concordCompare
    class QG_COPY,QG_DIRECT,CS_EXPORT,CC_EXPORT export
    class note1,note2,note3,note4,note5 note

    style QUERY_GEN fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    style QG_TYPES fill:#bbdefb,stroke:#1976d2,stroke-width:2px
    style QG_EXPORT fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    style CONCORD_SINGLE fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    style CONCORD_COMPARE fill:#ffe0b2,stroke:#ff6f00,stroke-width:2px
    style STATS fill:#f5f5f5,stroke:#616161,stroke-width:2px,stroke-dasharray: 3 3
    style TOOLS fill:#e0f2f1,stroke:#00796b,stroke-width:2px,stroke-dasharray: 3 3
