flowchart TD
    %% ========================================
    %% MODULE 9 - VISUALISATION ET GÃ‰NÃ‰RATEUR DE REQUÃŠTES
    %% ========================================

    START([ğŸ“Š MODULE 9<br/>Visualisation & GÃ©nÃ©rateur de RequÃªtes<br/>Analyse du Corpus NoSketch-Engine])

    %% ========================================
    %% DÃ‰CISION PRINCIPALE
    %% ========================================
    DECISION{Quelle<br/>fonctionnalitÃ© ?}

    START --> DECISION

    %% ========================================
    %% BRANCHE 1 : GÃ‰NÃ‰RATEUR DE REQUÃŠTES
    %% ========================================
    subgraph GENERATOR_FLOW [ğŸ” GÃ©nÃ©rateur de RequÃªtes CQL]
        GEN_START[GÃ©nÃ©rateur de requÃªtes]

        subgraph QUERY_TYPES [Types de RequÃªtes]
            TYPE_PROXIMITE[ğŸ“ 1.1.1 ProximitÃ©<br/>Recherche mots proches]
            TYPE_VARIATIONS[ğŸ”„ 1.1.2 Variations<br/>Formes alternatives]
            TYPE_PROX_VAR["ğŸ“ğŸ”„ 1.1.3 ProximitÃ© + Variations<br/>Combinaison des deux"]
            TYPE_SEMANTIC[ğŸ§  1.1.4 Contexte SÃ©mantique<br/>Relations sÃ©mantiques]
        end

        GEN_CQL["âš™ï¸ 1.1.1.1 GÃ©nÃ©ration CQL<br/>Corpus Query Language"]

        subgraph EXPORT_OPTIONS [Options d'Export]
            EXPORT_COPY[ğŸ“‹ 1.1.1.1.1 Copier-coller<br/>RequÃªte CQL]
            EXPORT_DIRECT[ğŸš€ 1.1.1.1.2 Export direct<br/>vers NoSketch-Engine<br/>ExÃ©cution automatique]
        end

        GEN_START --> TYPE_PROXIMITE
        GEN_START --> TYPE_VARIATIONS
        GEN_START --> TYPE_PROX_VAR
        GEN_START --> TYPE_SEMANTIC

        TYPE_PROXIMITE --> GEN_CQL
        TYPE_VARIATIONS --> GEN_CQL
        TYPE_PROX_VAR --> GEN_CQL
        TYPE_SEMANTIC --> GEN_CQL

        GEN_CQL --> EXPORT_COPY
        GEN_CQL --> EXPORT_DIRECT
    end

    DECISION -->|GÃ©nÃ©rer requÃªte| GEN_START

    %% ========================================
    %% BRANCHE 2 : VISUALISATION - 1 IMPORT
    %% ========================================
    subgraph VIZ_SINGLE_FLOW [ğŸ“ˆ Visualisation - 1 Export NoSketch]
        SINGLE_IMPORT["ğŸ“¥ 1.2.1 Import export NS<br/>Format normÃ© NoSketch-Engine"]

        SINGLE_FILTERS["ğŸšï¸ 1.2.1.1 Filtres configurables<br/>SÃ©lection Ã  la carte:<br/>â€¢ FrÃ©quence<br/>â€¢ POS (Part-of-Speech)<br/>â€¢ Lemme<br/>â€¢ PÃ©riode<br/>â€¢ Source"]

        subgraph SINGLE_PANELS [6 Panels de Visualisation]
            PANEL1[ğŸ“Š Panel 1<br/>Distribution frÃ©quences]
            PANEL2[ğŸ“Š Panel 2<br/>Concordances KWIC]
            PANEL3[ğŸ“Š Panel 3<br/>Collocations]
            PANEL4[ğŸ“Š Panel 4<br/>Timeline temporel]
            PANEL5[ğŸ“Š Panel 5<br/>RÃ©partition par source]
            PANEL6[ğŸ“Š Panel 6<br/>RÃ©seau sÃ©mantique]
        end

        SINGLE_EXPORT["ğŸ’¾ 1.2.1.1.1.1 Export panels<br/>Formats: CSV, JSON, PNG"]

        SINGLE_IMPORT --> SINGLE_FILTERS
        SINGLE_FILTERS --> PANEL1
        SINGLE_FILTERS --> PANEL2
        SINGLE_FILTERS --> PANEL3
        SINGLE_FILTERS --> PANEL4
        SINGLE_FILTERS --> PANEL5
        SINGLE_FILTERS --> PANEL6

        PANEL1 --> SINGLE_EXPORT
        PANEL2 --> SINGLE_EXPORT
        PANEL3 --> SINGLE_EXPORT
        PANEL4 --> SINGLE_EXPORT
        PANEL5 --> SINGLE_EXPORT
        PANEL6 --> SINGLE_EXPORT
    end

    DECISION -->|Visualiser 1 export| SINGLE_IMPORT

    %% ========================================
    %% BRANCHE 3 : VISUALISATION - 2 IMPORTS (COMPARAISON)
    %% ========================================
    subgraph VIZ_DOUBLE_FLOW [ğŸ“Š Visualisation - Comparaison 2 Exports]
        DOUBLE_IMPORT["ğŸ“¥ğŸ“¥ 1.2.2 Import 2 exports NS<br/>Formats normÃ©s NoSketch-Engine"]

        DOUBLE_FILTERS["ğŸšï¸ 1.2.2.1 Filtres configurables<br/>SÃ©lection Ã  la carte pour chaque export"]

        subgraph DOUBLE_PANELS_1 [6 Panels - Export 1]
            D_PANEL1_1[ğŸ“Š Panel 1.1<br/>Distribution export 1]
            D_PANEL2_1[ğŸ“Š Panel 2.1<br/>Concordances export 1]
            D_PANEL3_1[ğŸ“Š Panel 3.1<br/>Collocations export 1]
            D_PANEL4_1[ğŸ“Š Panel 4.1<br/>Timeline export 1]
            D_PANEL5_1[ğŸ“Š Panel 5.1<br/>RÃ©partition export 1]
            D_PANEL6_1[ğŸ“Š Panel 6.1<br/>RÃ©seau export 1]
        end

        subgraph COMPARISON_PANEL [Panel de Comparaison]
            COMPARE[ğŸ”€ 1.2.2.1.2 Panel Comparaison<br/>Analyse diffÃ©rentielle:<br/>â€¢ Ã‰carts frÃ©quences<br/>â€¢ Collocations distinctives<br/>â€¢ Ã‰volution temporelle<br/>â€¢ Statistiques comparatives]
        end

        DOUBLE_EXPORT["ğŸ’¾ Export tous panels<br/>Formats: CSV, JSON, PNG"]

        DOUBLE_IMPORT --> DOUBLE_FILTERS
        DOUBLE_FILTERS --> D_PANEL1_1
        DOUBLE_FILTERS --> D_PANEL2_1
        DOUBLE_FILTERS --> D_PANEL3_1
        DOUBLE_FILTERS --> D_PANEL4_1
        DOUBLE_FILTERS --> D_PANEL5_1
        DOUBLE_FILTERS --> D_PANEL6_1
        DOUBLE_FILTERS --> COMPARE

        D_PANEL1_1 --> DOUBLE_EXPORT
        D_PANEL2_1 --> DOUBLE_EXPORT
        D_PANEL3_1 --> DOUBLE_EXPORT
        D_PANEL4_1 --> DOUBLE_EXPORT
        D_PANEL5_1 --> DOUBLE_EXPORT
        D_PANEL6_1 --> DOUBLE_EXPORT
        COMPARE --> DOUBLE_EXPORT
    end

    DECISION -->|Comparer 2 exports| DOUBLE_IMPORT

    %% ========================================
    %% SORTIE
    %% ========================================
    OUTPUT([ğŸ“¤ SORTIE MODULE 9<br/>RequÃªtes CQL + Visualisations<br/>Analyses exportÃ©es])

    EXPORT_COPY --> OUTPUT
    EXPORT_DIRECT --> OUTPUT
    SINGLE_EXPORT --> OUTPUT
    DOUBLE_EXPORT --> OUTPUT

    %% ========================================
    %% ANNOTATIONS
    %% ========================================
    note1["ğŸ’¡ CQL:<br/>Corpus Query Language<br/>Langage standard NoSketch<br/>RequÃªtes complexes possibles"]
    note2["ğŸ’¡ Export normÃ© NS:<br/>Format CSV standardisÃ©<br/>Colonnes: Mot, FrÃ©quence,<br/>Contexte gauche/droit, MÃ©tadonnÃ©es"]
    note3["ğŸ’¡ Panels modulables:<br/>Interface interactive<br/>Zoom, filtrage dynamique<br/>Personnalisation affichage"]
    note4["ğŸ’¡ Comparaison:<br/>Analyse contrastive<br/>Identification diffÃ©rences<br/>Tests statistiques"]
    note5["ğŸ’¡ Export multi-formats:<br/>CSV: donnÃ©es brutes<br/>JSON: donnÃ©es structurÃ©es<br/>PNG: visualisations graphiques"]

    TYPE_PROXIMITE -.-> note1
    SINGLE_IMPORT -.-> note2
    PANEL1 -.-> note3
    COMPARE -.-> note4
    SINGLE_EXPORT -.-> note5

    %% ========================================
    %% STATISTIQUES
    %% ========================================
    subgraph STATS [ğŸ“Š Statistiques Indicatives]
        S1[4 types de requÃªtes CQL]
        S2[6 panels de visualisation]
        S3[1 panel de comparaison]
        S4[3 formats export: CSV, JSON, PNG]
        S5[Filtres: FrÃ©quence, POS, Lemme, etc.]
    end

    %% ========================================
    %% OUTILS
    %% ========================================
    subgraph TOOLS [ğŸ› ï¸ Technologies]
        T1[NoSketch-Engine: Source donnÃ©es]
        T2[CQL: Langage requÃªtes]
        T3[Python: Backend analyse]
        T4[Matplotlib/Plotly: Visualisations]
        T5[Pandas: Manipulation donnÃ©es]
    end

    %% ========================================
    %% STYLES
    %% ========================================
    classDef startEnd fill:#4caf50,stroke:#2e7d32,stroke-width:3px,color:#fff
    classDef decision fill:#ffeb3b,stroke:#f57f17,stroke-width:3px
    classDef generator fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef query fill:#bbdefb,stroke:#1976d2,stroke-width:2px
    classDef export fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    classDef vizSingle fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef vizDouble fill:#ffecb3,stroke:#ff6f00,stroke-width:2px
    classDef panel fill:#b2dfdb,stroke:#00796b,stroke-width:2px
    classDef comparison fill:#ffccbc,stroke:#d84315,stroke-width:2px
    classDef note fill:#fff9c4,stroke:#f57f17,stroke-width:1px,stroke-dasharray: 5 5

    class START,OUTPUT startEnd
    class DECISION decision
    class GEN_START,GEN_CQL generator
    class TYPE_PROXIMITE,TYPE_VARIATIONS,TYPE_PROX_VAR,TYPE_SEMANTIC query
    class EXPORT_COPY,EXPORT_DIRECT,SINGLE_EXPORT,DOUBLE_EXPORT export
    class SINGLE_IMPORT,SINGLE_FILTERS vizSingle
    class DOUBLE_IMPORT,DOUBLE_FILTERS vizDouble
    class PANEL1,PANEL2,PANEL3,PANEL4,PANEL5,PANEL6,D_PANEL1_1,D_PANEL2_1,D_PANEL3_1,D_PANEL4_1,D_PANEL5_1,D_PANEL6_1 panel
    class COMPARE comparison
    class note1,note2,note3,note4,note5 note

    style GENERATOR_FLOW fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    style QUERY_TYPES fill:#bbdefb,stroke:#1976d2,stroke-width:2px
    style EXPORT_OPTIONS fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    style VIZ_SINGLE_FLOW fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    style SINGLE_PANELS fill:#b2dfdb,stroke:#00796b,stroke-width:2px
    style VIZ_DOUBLE_FLOW fill:#ffe0b2,stroke:#ff6f00,stroke-width:2px
    style DOUBLE_PANELS_1 fill:#b2dfdb,stroke:#00796b,stroke-width:2px
    style COMPARISON_PANEL fill:#ffccbc,stroke:#d84315,stroke-width:2px
    style STATS fill:#f5f5f5,stroke:#616161,stroke-width:2px,stroke-dasharray: 3 3
    style TOOLS fill:#e0f2f1,stroke:#00796b,stroke-width:2px,stroke-dasharray: 3 3
