flowchart TD
    %% ========================================
    %% LATIN ANALYZER - ANALYSEUR DE TEXTES LATINS M√âDI√âVAUX
    %% ========================================
    %%
    %% Ce sch√©ma pr√©sente le workflow complet de l'analyseur de textes
    %% latins m√©di√©vaux (Version 2.3), un outil automatis√© de validation
    %% et de d√©tection intelligente des erreurs dans les textes latins.
    %%
    %% COMMANDES CLI DISPONIBLES :
    %% ---------------------------
    %% # Analyser un fichier texte
    %% python3 latin_analyzer_v2.py -i texte.txt -o resultat.docx
    %%
    %% # Analyser des XML Pages (mode single colonne)
    %% python3 latin_analyzer_v2.py -i corpus_xml/ -o resultat.docx -m xml-single
    %%
    %% # Analyser des XML Pages (mode dual - 2 colonnes)
    %% python3 latin_analyzer_v2.py -i corpus_xml/ -o resultat.docx -m xml-dual
    %%
    %% # Avec dictionnaire Du Cange personnalis√©
    %% python3 latin_analyzer_v2.py -i texte.txt -o resultat.docx -d /chemin/ducange.txt
    %%
    %% # Avec rapport d'analyse des mots orange (non reconnus)
    %% python3 latin_analyzer_v2.py -i texte.txt -o resultat.docx --report analyse.txt
    %%
    %% LIEN AVEC LES AUTRES MODULES :
    %% ------------------------------
    %% Entr√©e typique : XML Pages depuis Module 4 (eScriptorium) ou Module 5 (Post-traitement)
    %% Utilisation recommand√©e : Validation qualit√© des transcriptions HTR/OCR
    %% ========================================

    START([üîç LATIN ANALYZER<br/>Analyseur de textes latins m√©di√©vaux<br/>Version 2.3])

    %% ========================================
    %% INSTALLATION (PR√âREQUIS)
    %% ========================================
    subgraph INSTALL [üîß Installation - Pr√©requis]
        INSTALL_TITLE[üì¶ Installation automatique<br/>via setup.sh]
        INSTALL_PYCOLLATINUS[üìö PyCollatinus<br/>Lemmatiseur latin classique<br/>~500k formes]
        INSTALL_DUCANGE[üìñ Dictionnaire Du Cange<br/>Latin m√©di√©val<br/>99 917 mots]
        INSTALL_DEPS[‚öôÔ∏è D√©pendances Python<br/>python-docx, lxml, unidecode]
        INSTALL_READY[‚úÖ Installation pr√™te<br/>~3 minutes]

        INSTALL_TITLE --> INSTALL_PYCOLLATINUS
        INSTALL_TITLE --> INSTALL_DUCANGE
        INSTALL_TITLE --> INSTALL_DEPS
        INSTALL_PYCOLLATINUS --> INSTALL_READY
        INSTALL_DUCANGE --> INSTALL_READY
        INSTALL_DEPS --> INSTALL_READY
    end

    START -.->|Pr√©requis| INSTALL

    %% ========================================
    %% ENTR√âE
    %% ========================================
    INPUT_DECISION{Type<br/>d'entr√©e ?}

    START --> INPUT_DECISION

    %% ========================================
    %% √âTAPE 1 : EXTRACTION ET PR√â-TRAITEMENT
    %% ========================================
    subgraph STEP1 [üìÑ √âTAPE 1 : Extraction et Pr√©-traitement]
        %% Branche XML
        XML_DECISION{Mode<br/>colonnes ?}
        XML_SINGLE[üìÑ XML Single<br/>1 colonne]
        XML_DUAL[üìÑüìÑ XML Dual<br/>2 colonnes]
        XML_PARSE[üîç Extraction MainZone<br/>PageXMLParser]
        XML_LINES[üìù Lignes extraites]

        %% Branche TXT
        TXT_READ[üìñ Lecture fichier TXT<br/>Texte brut]
        TXT_LINES[üìù Lignes lues]

        %% Fusion commune
        MERGE_HYPHENS[üîó Fusion mots coup√©s<br/>sancti- + tatis ‚Üí sanctitatis]
        STEP1_OUTPUT[‚úÖ Texte pr√©-trait√©]

        XML_DECISION -->|single| XML_SINGLE
        XML_DECISION -->|dual| XML_DUAL
        XML_SINGLE --> XML_PARSE
        XML_DUAL --> XML_PARSE
        XML_PARSE --> XML_LINES
        XML_LINES --> MERGE_HYPHENS

        TXT_READ --> TXT_LINES
        TXT_LINES --> MERGE_HYPHENS

        MERGE_HYPHENS --> STEP1_OUTPUT
    end

    INPUT_DECISION -->|XML Pages| XML_DECISION
    INPUT_DECISION -->|Fichier TXT| TXT_READ

    %% ========================================
    %% √âTAPE 2 : NORMALISATION
    %% ========================================
    subgraph STEP2 [üîÑ √âTAPE 2 : Normalisation]
        NORM_UV[üî§ Normalisation u/v<br/>uel ‚Üí vel<br/>uidetur ‚Üí videtur]
        NORM_IJ[üî§ Normalisation i/j<br/>iam ‚Üí jam<br/>iudicium ‚Üí judicium]
        FILTER_ROMAN[üî¢ Filtrage chiffres romains<br/>xuiii., uii., ui.<br/>exclus de l'analyse]
        STEP2_OUTPUT[‚úÖ Texte normalis√©]

        NORM_UV --> NORM_IJ
        NORM_IJ --> FILTER_ROMAN
        FILTER_ROMAN --> STEP2_OUTPUT
    end

    STEP1_OUTPUT --> NORM_UV

    %% ========================================
    %% √âTAPE 3 : ANALYSE MULTI-SOURCES
    %% ========================================
    subgraph STEP3 [üß† √âTAPE 3 : Analyse Multi-Sources]
        ANALYSIS_START[üìñ Pour chaque mot<br/>Contexte ¬±3 mots]

        %% Analyse PyCollatinus
        COLLATINUS_TITLE[üèõÔ∏è PyCollatinus]
        COLLATINUS_TEST[üîç Test latin classique<br/>Lemmatisation]
        COLLATINUS_RESULT{Reconnu ?}
        COLLATINUS_YES[‚úÖ +30 points<br/>Latin classique valide]
        COLLATINUS_NO[‚ùå 0 points]

        %% Analyse Du Cange
        DUCANGE_TITLE[üìñ Du Cange]
        DUCANGE_TEST[üîç Test latin m√©di√©val<br/>Dictionnaire 99k mots]
        DUCANGE_RESULT{Pr√©sent ?}
        DUCANGE_YES[‚úÖ +40 points<br/>Latin m√©di√©val valide]
        DUCANGE_NO[‚ùå 0 points]

        ANALYSIS_START --> COLLATINUS_TITLE
        COLLATINUS_TITLE --> COLLATINUS_TEST
        COLLATINUS_TEST --> COLLATINUS_RESULT
        COLLATINUS_RESULT -->|Oui| COLLATINUS_YES
        COLLATINUS_RESULT -->|Non| COLLATINUS_NO

        ANALYSIS_START --> DUCANGE_TITLE
        DUCANGE_TITLE --> DUCANGE_TEST
        DUCANGE_TEST --> DUCANGE_RESULT
        DUCANGE_RESULT -->|Oui| DUCANGE_YES
        DUCANGE_RESULT -->|Non| DUCANGE_NO

        STEP3_OUTPUT[üìä R√©sultats combin√©s<br/>pour chaque mot]

        COLLATINUS_YES --> STEP3_OUTPUT
        COLLATINUS_NO --> STEP3_OUTPUT
        DUCANGE_YES --> STEP3_OUTPUT
        DUCANGE_NO --> STEP3_OUTPUT
    end

    STEP2_OUTPUT --> ANALYSIS_START

    %% ========================================
    %% √âTAPE 4 : SCORING MULTI-CRIT√àRES
    %% ========================================
    subgraph STEP4 [üéØ √âTAPE 4 : Scoring Multi-Crit√®res]
        SCORE_START[üî¢ Calcul score 0-100]

        CRIT1[Crit√®re 1:<br/>Latin classique<br/>+30 points]
        CRIT2[Crit√®re 2:<br/>Latin m√©di√©val<br/>+40 points]
        CRIT3[Crit√®re 3:<br/>Suffixe productif<br/>-arius, -atio, etc.<br/>+10 points]
        CRIT4[Crit√®re 4:<br/>Contexte eccl√©siastique<br/>abbas, ecclesia, etc.<br/>+5 points]
        CRIT5[Crit√®re 5:<br/>Variante orthographique<br/>ae‚Üîe, ti‚Üîci<br/>+10 points]

        SCORE_CALC[‚ûï Score total<br/>maximum 100 points]

        COLOR_DECISION{Score ?}
        COLOR_BLACK[‚ö´ Noir<br/>Score ‚â•75<br/>Mot valid√©]
        COLOR_ORANGE[üü† Orange<br/>Score 40-74<br/>√Ä v√©rifier]
        COLOR_RED[üî¥ Rouge<br/>Score <40<br/>Erreur probable]

        SCORE_START --> CRIT1
        SCORE_START --> CRIT2
        SCORE_START --> CRIT3
        SCORE_START --> CRIT4
        SCORE_START --> CRIT5

        CRIT1 --> SCORE_CALC
        CRIT2 --> SCORE_CALC
        CRIT3 --> SCORE_CALC
        CRIT4 --> SCORE_CALC
        CRIT5 --> SCORE_CALC

        SCORE_CALC --> COLOR_DECISION
        COLOR_DECISION -->|‚â•75| COLOR_BLACK
        COLOR_DECISION -->|40-74| COLOR_ORANGE
        COLOR_DECISION -->|<40| COLOR_RED

        STEP4_OUTPUT[üé® Attribution couleur<br/>pour chaque mot]

        COLOR_BLACK --> STEP4_OUTPUT
        COLOR_ORANGE --> STEP4_OUTPUT
        COLOR_RED --> STEP4_OUTPUT
    end

    STEP3_OUTPUT --> SCORE_START

    %% ========================================
    %% √âTAPE 5 : G√âN√âRATION DES SORTIES
    %% ========================================
    subgraph STEP5 [üì§ √âTAPE 5 : G√©n√©ration des Sorties]
        OUTPUT_START[üìù G√©n√©ration des fichiers]

        %% Document DOCX
        DOCX_GEN[üìÑ Document DOCX<br/>Colorisation 3 niveaux]
        DOCX_FORMAT[‚ú® Formatage<br/>Page A3 paysage<br/>L√©gende incluse]
        DOCX_FILE[üìÅ Fichier DOCX<br/>resultat.docx]

        %% Rapport optionnel
        REPORT_DECISION{Rapport<br/>demand√© ?}
        REPORT_GEN[üìä G√©n√©ration rapport<br/>Analyse mots orange]
        REPORT_STATS[üìà Statistiques d√©taill√©es<br/>Distribution, patterns, TOP 50]
        REPORT_CATEG[üìÇ Cat√©gorisation<br/>Abr√©viations, erreurs OCR, variantes]
        REPORT_RECO[üí° Recommandations<br/>Am√©liorations potentielles]
        REPORT_FILE[üìÅ Fichier rapport<br/>analyse_orange.txt]

        OUTPUT_START --> DOCX_GEN
        DOCX_GEN --> DOCX_FORMAT
        DOCX_FORMAT --> DOCX_FILE

        OUTPUT_START --> REPORT_DECISION
        REPORT_DECISION -->|Oui --report| REPORT_GEN
        REPORT_DECISION -->|Non| DOCX_FILE
        REPORT_GEN --> REPORT_STATS
        REPORT_STATS --> REPORT_CATEG
        REPORT_CATEG --> REPORT_RECO
        REPORT_RECO --> REPORT_FILE
    end

    STEP4_OUTPUT --> OUTPUT_START

    %% ========================================
    %% SORTIE FINALE
    %% ========================================
    OUTPUT([üì§ SORTIE LATIN ANALYZER<br/>Document valid√© + Rapport optionnel])

    DOCX_FILE --> OUTPUT
    REPORT_FILE -.-> OUTPUT

    %% ========================================
    %% LIEN AVEC MODULES PROJET
    %% ========================================
    MODULE4_OUTPUT[üì§ MODULE 4<br/>XML Pages eScriptorium<br/>Transcriptions HTR/OCR]
    MODULE5_OUTPUT[üì§ MODULE 5<br/>XML Pages post-trait√©s<br/>Texte nettoy√©]

    MODULE4_OUTPUT -.->|Validation qualit√©| INPUT_DECISION
    MODULE5_OUTPUT -.->|Validation qualit√©| INPUT_DECISION

    %% ========================================
    %% ANNOTATIONS
    %% ========================================
    note1[üí° Fusion c√©sures:<br/>Traite automatiquement<br/>les mots coup√©s en fin de ligne<br/>Bas√© sur pattern regex]
    note2[üí° Normalisation:<br/>u/v et i/j trait√©s comme identiques<br/>G√®re variantes m√©di√©vales<br/>uel=vel, uidetur=videtur]
    note3[üí° PyCollatinus:<br/>~500k formes latines classiques<br/>Lemmatisation automatique<br/>API Python int√©gr√©e]
    note4[üí° Du Cange:<br/>99 917 mots de latin m√©di√©val<br/>Eccl√©siastique, f√©odal, administratif<br/>T√©l√©charg√© via setup.sh]
    note5[üí° Scoring:<br/>Multi-crit√®res 0-100<br/>√âvite les faux positifs<br/>Contextualisation intelligente]
    note6[üí° Rapport orange:<br/>Analyse d√©taill√©e des mots non reconnus<br/>Patterns, fr√©quences, recommandations<br/>Estimation am√©lioration potentielle]
    note7[üí° CLI flexible:<br/>Arguments -i input, -o output<br/>Mode -m txt/xml-single/xml-dual<br/>Pas de chemins en dur]

    MERGE_HYPHENS -.-> note1
    NORM_UV -.-> note2
    COLLATINUS_TEST -.-> note3
    DUCANGE_TEST -.-> note4
    SCORE_CALC -.-> note5
    REPORT_GEN -.-> note6
    START -.-> note7

    %% ========================================
    %% OUTILS
    %% ========================================
    subgraph TOOLS [üõ†Ô∏è Outils et Technologies]
        T1[Python 3.10+ : Langage principal]
        T2[PyCollatinus : Lemmatisation classique]
        T3[Du Cange : Dictionnaire m√©di√©val]
        T4[python-docx : G√©n√©ration DOCX]
        T5[lxml : Parsing XML Pages]
        T6[PageXMLParser : Extraction MainZone]
    end

    %% ========================================
    %% WORKFLOW R√âSUM√â
    %% ========================================
    subgraph WORKFLOW [üîÑ Workflow Complet R√©sum√©]
        W1[1. Extraction : XML ou TXT]
        W2[2. Normalisation : u/v, i/j]
        W3[3. Analyse : PyCollatinus + Du Cange]
        W4[4. Scoring : 0-100 points]
        W5[5. Colorisation : Noir/Orange/Rouge]
        W6[6. Export : DOCX + Rapport]

        W1 --> W2
        W2 --> W3
        W3 --> W4
        W4 --> W5
        W5 --> W6
    end

    %% ========================================
    %% AVANTAGES vs V1
    %% ========================================
    subgraph AVANTAGES [‚úÖ Avantages vs. Version 1.x]
        A1[‚úÖ Automatique via CLI vs. GUI manuel]
        A2[‚úÖ 86% reconnaissance vs. 60%]
        A3[‚úÖ Scoring 0-100 vs. binaire]
        A4[‚úÖ XML Pages int√©gr√©]
        A5[‚úÖ Normalisation u/v, i/j]
        A6[‚úÖ Rapport d'analyse d√©taill√©]
    end

    %% ========================================
    %% STYLES
    %% ========================================
    classDef startEnd fill:#4caf50,stroke:#2e7d32,stroke-width:3px,color:#fff
    classDef decision fill:#ffeb3b,stroke:#f57f17,stroke-width:2px
    classDef install fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef extract fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef normalize fill:#f3e5f5,stroke:#8e24aa,stroke-width:2px
    classDef analysis fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef score fill:#c8e6c9,stroke:#388e3c,stroke-width:2px
    classDef output fill:#ffccbc,stroke:#d84315,stroke-width:2px
    classDef success fill:#a5d6a7,stroke:#2e7d32,stroke-width:2px
    classDef warning fill:#ffab91,stroke:#d84315,stroke-width:2px
    classDef error fill:#ef9a9a,stroke:#c62828,stroke-width:2px
    classDef note fill:#fff9c4,stroke:#f57f17,stroke-width:1px,stroke-dasharray: 5 5
    classDef module fill:#b3e5fc,stroke:#01579b,stroke-width:2px

    class START,OUTPUT startEnd
    class INPUT_DECISION,XML_DECISION,COLLATINUS_RESULT,DUCANGE_RESULT,COLOR_DECISION,REPORT_DECISION decision
    class INSTALL_TITLE,INSTALL_PYCOLLATINUS,INSTALL_DUCANGE,INSTALL_DEPS,INSTALL_READY install
    class XML_SINGLE,XML_DUAL,XML_PARSE,XML_LINES,TXT_READ,TXT_LINES,MERGE_HYPHENS,STEP1_OUTPUT extract
    class NORM_UV,NORM_IJ,FILTER_ROMAN,STEP2_OUTPUT normalize
    class ANALYSIS_START,COLLATINUS_TITLE,COLLATINUS_TEST,DUCANGE_TITLE,DUCANGE_TEST,STEP3_OUTPUT analysis
    class SCORE_START,CRIT1,CRIT2,CRIT3,CRIT4,CRIT5,SCORE_CALC,STEP4_OUTPUT score
    class OUTPUT_START,DOCX_GEN,DOCX_FORMAT,DOCX_FILE,REPORT_GEN,REPORT_STATS,REPORT_CATEG,REPORT_RECO,REPORT_FILE output
    class COLLATINUS_YES,DUCANGE_YES,COLOR_BLACK success
    class COLOR_ORANGE warning
    class COLLATINUS_NO,DUCANGE_NO,COLOR_RED error
    class note1,note2,note3,note4,note5,note6,note7 note
    class MODULE4_OUTPUT,MODULE5_OUTPUT module

    style INSTALL fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    style STEP1 fill:#e8f5e9,stroke:#1565c0,stroke-width:2px
    style STEP2 fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    style STEP3 fill:#fff8e1,stroke:#e65100,stroke-width:2px
    style STEP4 fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    style STEP5 fill:#ffebee,stroke:#d84315,stroke-width:2px
    style TOOLS fill:#e0f2f1,stroke:#00796b,stroke-width:2px,stroke-dasharray: 3 3
    style WORKFLOW fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px,stroke-dasharray: 3 3
    style AVANTAGES fill:#f1f8e9,stroke:#689f38,stroke-width:2px,stroke-dasharray: 3 3
